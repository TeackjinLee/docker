![image](https://github.com/user-attachments/assets/d45d4cf5-99c4-4827-ba7c-bf2c2b873e38)오케스트레이션은 여러 대의 물리 서버에 걸쳐 컨테이너로 애플리케이션을 싱행하는 것을 말한다. 도커 이미지와 컴포즈 파일은 전과 같지만,<br>
컨테이너를 수동으로 직접 관리했던 이전과 비교하면 클러스터에 컨테이너 관리를 위임한다는 점이 다르다. 3부에서는 도커에 내장된 오케스트레이션 도구인 도커 스웜의 사용법을 배운다.<br>
그리고 애플리케이션 업데이트 및 롤백 절차, CI파이프라인을 클러스터와 연결해 지속적 통합에서 한 발짝 더 나아간 지속적 배포를 실현하는 방법도 알아본다.<br>

# 12.1 컨테이너 오케스트레이션 도구란?

도커 컴포즈는 단일 도커 호스트에서 컨테이너를 실행하기 위한 도구였다.<br>
하지만 운영 환경은 단일 호스트로만 구성되지 않는다. 단일 호스트는 한 대만 고장을 일으켜도 전체 애플리케이션이 중단된다.<br>
시스템은 고가용성을 요구, 이때 오케스트레이션이 필요.<br>
오케스트레이션 도구란 기본적으로 클러스터(cluster)를 구성하는 여러 대의 호스트 컴푸터를 의미, 컨테이너를 관리하는 도구이다.<br>

![image](https://github.com/user-attachments/assets/b6138e0b-0b40-4d6e-a7e0-26224843202c)

<br>
![image](https://github.com/user-attachments/assets/bb2bf119-0cc7-4e25-a7e8-7debd73ff841)
<br>
12-2그림에는 서버가 나타나 있지 않다. 오케스트레이션 도구가 각 서버, 네트워크, 스토리지 장치의 세부 사항을 가려 주기 때문이다.<br>
우리는 클러스터가 마치 하나의 대상인 것처럼 명령행 도구와 API를 통해 명령을 보내고 쿼리를 요청해 사용한다.<br>


# 12.2 도커 스웜으로 클러스터 만들기

[실습] 도커 CLI에는 클러스터 관리를 위한 명령도 준비돼있다. swarm init 명령을 사용하면 도커 엔진을 스웜 모드로 전환한다.<br>
      보통은 아무 인자 없이 사용하는 명령이지만, 호스트 컴퓨터가 하나 이상의 네트워크에 접속돼 있다면 스웜 통신에 사용할 IP주소를 선택하라는 메시지와 함께 오류를 일으킬 것이다.<br>

> docker swarm init<br>

![image](https://github.com/user-attachments/assets/aba8eb85-8601-4f9a-a4e2-bcd9b31a105f)

<br>
출력된 내용을 보면, 도커 스웜이 초기화 되고 나의 컴퓨터가 클러스터 매니저가 됐다.<br>
클러스터에 속한 컴퓨터는 매니저와 워커라는 두가지 역할 중 하나를 맡는다. 출력된 내용 중에는 다른 컴퓨터를 클러스터에 워커로 참여 시키기 위해 입력할 명령어도 있다.<br>

매니저 : 클러스터를 관리하는 작업을 직접 수행한다. 클러스터 데이터베이스 매니저 노드에 저장되며, 사용자가 YAML 파일을 전달하기 위해 사용하는 API도 매니저 노드에서 동작하고 컨테이너 모니터링과 스케줄링 모두 매니저 노드가 수행한다.<br>
워커 : 매니저의 스케줄링에 따라 컨테이너를 실행하고 그 상태를 주기적으로 매니저에 보고하는 역할을 하는데, 매니저도 워커의 역할을 수행할 수는 있다.<br>
스웜을 만들고 나면 원하는 만큼 컴퓨터를 스웜을 추가할 수 있다.<br>
스웜에 추가된 컴퓨터를 노드라고 부른다.<br>
스웜에 노드를 추가하기 위한 조건,<br> 
1. 해당 컴퓨터가 스웜과 같은 네트워크상에 있어야 한다.<br>
2. 스웜에 들어가기 위한 패스워드 역할을 하는 참가 토큰을 매니저로쿠터 발급 받아야 한다.<br>
[실습] 도커 엔진을 스웜 모드로 전환하고 나면, 도커 CLI에서 사용할 수 있는 새로운 명령이 많다. 이들 명령을 사용해 워커용 참가 토큰과 매니저용 참가 토큰을 각각 출력해 보고 스웜에 현재 참여 중인 노드의 목록도 확인하라.<br>

> 워커 노드로 스웜에 참여하기 위한 명령을 화면에 출력<br>
> docker swarm join-token worker<br>
> 매니저 노드로 스웜에 참여하기 위한 명령을 화면에 출력<br>
> docker swarm join-token manager<br>
> 스웜에 참여 중인 노드의 목록을 출력<br>
> docker node ls<br>

![image](https://github.com/user-attachments/assets/9fefb9bf-5593-44e8-afc3-f42b64048dff)

<br>
단일 노드 스웜도 노드가 여러 개인 스웜과 같은 방식으로 동작한다. 다른 점이 있다면, 노드가 하나인 만큼 노드가 여러 개인 스웜에 비해 높은 가용성을 가질수는 없으며 컨테이너 수를 원하는 만큼 증가시키는 스케일링이 불가능하다는 점이다.<br>
그림 12-15는 개발 환경과 테스트 환경에 적합한 단일 노드 스웜과 운영 환경에 사용되는 노드가 여러개인 클러스터를 비교한 것이다.<br>

![image](https://github.com/user-attachments/assets/8faf51c2-f404-4c1d-b59e-889848b3f56d)

<br>
도커 스웜이 쿠버네티스보다 나은 점 중 하나는 클러스터를 구성하고 관리하는 작업이 단순하다는 것이다.<br> 
1. 수십 대 정도 규모의 스웜을 각 호스트마다 도커를 설치하고 
2. 매니저 노드를 맡을 컴퓨터에서 docker swarm init 명령을 한번 실행<br>  
3. 나머지 노드에서 docker swarm join 명령을 실행하는 정도면 만들수 있다. 운영 환경에서도 더 복잡한 작업은 필요 없다.<br>

이제 단일 노드 스웜을 만들었으니 컨테이너 오케스트레이션의 관리 아래에서 애플리케이션이 어떻게 동작하는지 알아보자<br>

# 13.3 도커 스웜 서비스로 애플리케이션 실행하기



# 13.4 클러스터 환경에서 네트워크 트래픽 관리하기

# 13.5 도커 스웜과 쿠버네티스 중 무엇을 사용할까?

# 연습문제
