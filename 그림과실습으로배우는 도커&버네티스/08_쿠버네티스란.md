# 01 쿠버네티스란?

쿠버네티스 - 컨테이너 오케스트레이션 도구의 일종
쿠버네티스는 어떤 일을 할 수 있는가?
쿠버네티스는 여러대의 컨테이너가 여러대의 물리적 서버에 걸쳐 실행되는 것을 전제로 한다.
이렇게 여러 대의 서버에서 일일이 컨테이너를 실행하고 관리하기는 쉬운 일이 아니다.
쿠버네티스는 바로 이를 위한도구다.
예를 들어, 20개의 컨테이너를 만들려면 docker run 커맨드를 20번 실행해야 할 것이다. 매우 지겹고 지루한 작업이다.
쿠버네티스는 이렇게 번거로운 컨테이너 생성이나 관리의 수고를 덜어주는 도구다.

# 02 마스터 노드와 워커 노드

클러스터의 구성 - 마스터 노드, 워커노드 두가지로 나뉜다.
마스터 노드 - 컨테이너를 샐행하지는 않으며 워커노드에서 실행되는 컨테이너를 관리하는 역할을 한다. 컨테이너엔진설치 X etcd(키-값 스토어 타입의 데이터베이스, 이 밖의 다른목적으로 사용된다.) 설치
워커 노드 - 실제 서버에 해당하는 부분, 컨테이너가 실제 동작하는 서버다. 컨테이너설치 O

이렇게 마스터 노드와 워커 노드로 구성된 일군의 쿠버네티스 시스템을 클러스터 라고 한다.
클러스터 = 마스터노드 + 워커노드 

- 쿠버네티스를 사용하려면 먼저 설치가 필요하다
  쿠버네티스틑 도커 엔진과 별개의 소프트웨어다.
  그러므로 소프트웨어와  CNI(가상 네트워크 드라이버)를 설치해야 한다.

- 컨트롤 플레인(제어판)과 kubu-let
  마스터 노드는 컨트롤 플레인을 통해 워커 노드를 관리한다.

마스터 노드측 컨트롤 플레인의 구성
kube-apiserver : 외부와 통신하는 프로세스, kurbectl로부터 명령을 전달받아 실행한다.
kube-controller-manager : 컨트롤러를 통합 관리, 실행한다.
kube-scheduler : 파드를 워커 노드에 할당한다.
cloud-coltroller-manager : 클라우드 서비스와 연동해 서비스를 생성한다.
etcd : 클러스터 관련 정보 전반을 관리하는 데이터베이스

워커 노드에서는 kube-let과 kube-proxy가 동작.
kube-let은 마스터 노드의 kube-scheduler와 연동하며 워커 노드에 컨테이너 또는 볼륨을 배치하고 실행한다.

워커 노드의 구성
kube-let 마스터 노드에 있는 kube-scheduler와 연동하며 워커 노드에 파드를 배치하고 실행한다. 또 실행 중인 파드의 상태를 정기적으로 모니터링하며 kube-scheduler에 통지한다.
kube-proxy 네트워크 통신의 라우팅 메커니즘

* 쿠버네티스는 항상 '바람직한' 상태를 유지한다.
* 쿠버네티스를 사용하는 시스템에서 컨테이너 삭제
  - 쿠버네티스는 정의된 '바람직한 상태'를 유지한다.

# 03 쿠버네티스의 구성과 관련 용어

쿠버네티스의 구성과 관련된 용어(파드, 서비스, 디폴로이먼트, 레플리카세트)
파드(pod) : 컨테이너와 볼륨을 함께 묶은 것이다.(파드에는 볼륨이 없는경우도 있다.)
서비스(service) : 파드가 모여서 구성 - 여러개의 파드를 이끄는 반장
  서비스의 역할 - 로드밸런서(부하 분산 장치)
             - 각 서비스는 자동적으로 고정된 IP 주소를 부여받으며(cluster IP), 이 주소로 통신을 처리한다.
             - 내부적으로 여러게의 파드가 있어도 밖에서는 하나의 IP 주소(cluster IP)만 볼수 있으며, 이주소로 접근하면 서비스가 통신을 적절히 분배해주는 구조
             - 서비스가 분배하는 통신은 한 워커 노드 안으로 국한된다. 여러 워커 노드 간의 분배는 실제로드 벨런서 또는 인그레스(ingress)가 담당. 이들을 마스터 노드도 워커노드도 아닌 별도의 노드에서 동작하거나 물리적 전용 하드웨어다.
디플로이먼트와 레플리카세트 :
  레플리카세트 : 파드의 수를 관리하는 반장
    레플리카 : 레플리카세트가 관리하는 동일한 구성의 파드를 레플리카(replica)라고 부른다.
    * 그러므로 파드의 수를 조정하는것을 '레플리카의 수를 조정'한다고 하거나 파드의 수를 결정하는 것은 '레플리카 수를 결정'한다는 것이다.
  디플로이먼트 : 파드의 디플로이(배포)를 관리하는 요소로, 파드가 사용하는 이미지 등 파드에 대한 정보를 갖고 있다.
    * 레플리카세트는 다루기 어려우므로 단독으로 쓰이는 경우가 드물다. 따라서, 레플리카세트는 디플로이먼트(deployment)와 함께 쓰일 때가 많다.

# 그밖의 쿠버네티스 리소스
파드, 서비스, 디플로이먼트, 레플리카세트 등을 리소스라고 한다.
파드(pod) : 컨테이너와 볼륨을 합친것
파드템플릿(podtemplates) : 배포 시 파드의 형틀 역할
레플리케이션컨트롤러(replicationcontrollers) : 레플리케이션을 제어
리소스쿼터(resourcequotas) : 쿠버네티스 리소스의 사용량 제한을 설정
비밀값(secrets) : 키 정보를 관리
서비스어카운트(serviceaccounts) : 리소스를 다루는 사용자를 관리
서비스(services) : 파드에 요청을 배분
데몬세트(demonsets) : 워커노드마다 하나의 파드를 생성
디플로이먼트(deployments) : 파드의 배포를 관리
레플리카세트(replicasets) : 파드의 수를 관리
스테이트풀세트(statefulsets) : 파드의 배포를 상태를 유지하며 관리
크론잡(cronjobs) : 지정된 스케줄대로 파드를 실행
잡(jobs) : 파드를 한번 실행

# 쿠버네티스 용어 정리
요청과 곤련된 용어는 서비스와 클러스터IP이고, 수와 관련된 것은 레플리카세트와 디플로이먼트다.

# 04 쿠버네티스 설치 및 사용법

# 05 매니페스트 파일(정의 파일) 작성
매니페스트 파일이란?
  쿠버네티스는 매니페스트 파일(정의 파일)에 기재된 내용에 따라 파드를 생성.
  매니페스트 파일의 내용을 쿠버네티스에 업로드 하면 그 내용이 데이터베이스(바람직한 상태)로 등록

YAML 형식으로 매니페스트 파일 작성
  파드나 서비스에 대한 설정을 쿠버네티스트에서는 매니페스트라고 한다.
  이를 적은 파일을 매니페스트 파일(정의파일)이라 한다.
  매니페스트 파일은 YAML 또는 JSON형식으로 기재한다.

매니페스트 파일은 리소스 단위로 작성한다.
  매니페스트 파일은 리소스 단위로 작성한다. 리소스는 파드나 서비스, 디플로이먼트, 레플리카세트 등을 가리킨다. 8-4절에서 네가지 리소스에 대해 설명했는데, 초보자 수준에서 다루게 될 리소스는 '서비스'나 '디플로이먼트' 정도다.
  디플로이먼트 = 레플리카세트 + 파드
  예) 아파치 파드를 만들려면 '아파치 디플로이먼트'와 '아파치 서비스' 이렇게 두 개의 리소스를 작성.

매니페스트 파일은 여러 파일로 분할할 수 있다.
한파일로 작성할때 '---'로 구분한다.

# 매니페스트 파일로 작성할 내용
  매니페스트 파일도 내용이 복잡하므로 실습 전에 먼저 작성할 내용을 설명하겠다.
  apiVersion: API 그룹 및 버전
  kind : 리소스 유형
  metadata: 메타데이터
  spec: 리소스내용
  
  리소스          API그룹 / 버전      리소스 유형
  파드           core/v1            Pod
  서비스         core/v1            service
  디플로이먼트      apps/v1           Deployment 
  레플리카세트      apps/v1           ReplicaSet











  






















